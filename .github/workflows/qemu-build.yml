name: Build qemu-system-arm

on:
  push:
    branches: [ "master", "ci-test" ]

jobs:
  query-latest-tag:
      runs-on: ubuntu-latest
      outputs:
        tag: ${{steps.qemu.outputs.tags}}
      steps:
      - id: qemu
        uses: hakwerk/gha-git-repo-tags@main
        with:
          repository: qemu/qemu
          limit: 1

  check-build-condition:
    runs-on: ubuntu-latest
    needs: query-latest-tag
    outputs:
        skip: ${{steps.check-tag.outputs.exists}}
    strategy:
      matrix:
        tag: ${{ fromJson( needs.query-latest-tag.outputs.tag ) }}
    steps:
      - uses: mukunku/tag-exists-action@v1.6.0
        id: check-tag
        with: 
          tag: ${{ matrix.tag }}
          repo: ${{ env.GITHUB_REPOSITORY }}
          
  build:
    if: ${{needs.check-build-condition.outputs.skip}} == 'false'
    runs-on: ubuntu-latest
    needs: check-build-condition
    steps:
      - run: echo "Hello build job!!"

